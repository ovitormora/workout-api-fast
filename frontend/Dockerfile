#
# üéì DOCKERFILE ‚Äî Frontend (React + Vite)
#
# Um Dockerfile √© uma "receita" para criar uma imagem Docker.
# Cada linha (instru√ß√£o) adiciona uma "camada" √† imagem.
#
# Usamos multi-stage build (2 est√°gios):
#   - dev: para desenvolvimento (com hot reload)
#   - prod: para produ√ß√£o (servindo arquivos est√°ticos)
#

# === Est√°gio Base ===
# Come√ßa com uma imagem Node.js leve (Alpine Linux)
FROM node:20-alpine as base

# Define a pasta de trabalho dentro do container
WORKDIR /app

# Copia apenas os arquivos de depend√™ncias primeiro
# (isso aproveita o cache do Docker ‚Äî se as depend√™ncias
#  n√£o mudaram, n√£o precisa reinstalar)
COPY package.json package-lock.json ./

# --- Est√°gio de Desenvolvimento ---
FROM base as dev

# Instala TODAS as depend√™ncias (incluindo devDependencies)
RUN npm install

# Copia o restante do c√≥digo
COPY . .

# Exp√µe a porta do Vite dev server
EXPOSE 5173

# Inicia o servidor de desenvolvimento com hot reload
# --host 0.0.0.0 permite acesso de fora do container
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]

# --- Est√°gio de Produ√ß√£o ---
FROM base as prod

# Instala apenas depend√™ncias de produ√ß√£o
RUN npm ci --only=production

# Copia o c√≥digo e faz o build
COPY . .
RUN npm run build

# Usa Nginx para servir os arquivos est√°ticos
FROM nginx:alpine as production
COPY --from=prod /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
